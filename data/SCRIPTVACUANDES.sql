create sequence VacuAndes_sequence;
-- TABLA USUARIO
CREATE TABLE A_USUARIO 
   (ID NUMBER, 
	NOMBRE VARCHAR2(20 BYTE) NOT NULL, 
    cedula NUMBER NOT NULL,
    correo VARCHAR2(255 BYTE)NOT NULL,
    contrasenia VARCHAR2(20 BYTE) NOT NULL,
    TIPO VARCHAR2(20 BYTE) NOT NULL,
	CONSTRAINT USUARIO_PK PRIMARY KEY (ID));
    
    ALTER TABLE A_USUARIO
ADD CONSTRAINT CK_U_TIPO 
	CHECK (TIPO IN ('CIUDADANO', 'OPERADOR', 'ADMINISTRADOR'))
ENABLE;


-- TABLA VACUNA
CREATE TABLE A_VACUNA 
   (ID NUMBER, 
	FABRICANTE VARCHAR2(20 BYTE) NOT NULL,
    IDLOTE NUMBER NOT NULL, 
	CONSTRAINT VACUNA_PK PRIMARY KEY (ID));


    ALTER TABLE A_VACUNA
ADD CONSTRAINT fk_v_idlote
    FOREIGN KEY (IDLOTE)
    REFERENCES A_LOTEVACUNA(ID)
ENABLE;

--TABLA LOTE

CREATE TABLE A_LOTEVACUNA 
   (ID NUMBER, 
    CANTIDAD NUMBER NOT NULL,
    IDEPS NUMBER NOT NULL,
    IDPUNTOV NUMBER NOT NULL,
	CONSTRAINT LOTEVACUNA_PK PRIMARY KEY (ID));
 
    ALTER TABLE A_LOTEVACUNA
ADD CONSTRAINT fk_l_ideps
    FOREIGN KEY (IDEPS)
    REFERENCES A_EPSREGIONAL(ID)
ENABLE;

    ALTER TABLE A_LOTEVACUNA
ADD CONSTRAINT fk_l_idpuntov
    FOREIGN KEY (IDPUNTOV)
    REFERENCES A_PUNTOVACUNACION(ID)
ENABLE;

--TABLA CIUDADANO
    
CREATE TABLE A_CIUDADANO 
   (ID NUMBER, 
	EDAD NUMBER NOT NULL, 
    OCUPACION VARCHAR2(20 BYTE) NOT NULL,
    ENFERMEDAD NUMBER NOT NULL, 
    GRUPO VARCHAR2(20 BYTE) NOT NULL,
    ETAPA NUMBER NOT NULL,
    ESTADO VARCHAR2(20 BYTE) NOT NULL,
    IDUSUARIO NUMBER NOT NULL,
    IDPUNTOV NUMBER NOT NULL,
	CONSTRAINT CIUDADANO_PK PRIMARY KEY (ID));
    
    ALTER TABLE A_CIUDADANO
ADD CONSTRAINT fk_c_idpuntov
    FOREIGN KEY (IDPUNTOV)
    REFERENCES A_PUNTOVACUNACION(ID)
ENABLE;
    
 ALTER TABLE A_CIUDADANO
ADD CONSTRAINT CK_C_GRUPO 
CHECK (GRUPO IN ('PRIMERO', 'SEGUNDO', 'TERCERO','CUARTO'))
ENABLE;

 ALTER TABLE A_CIUDADANO
ADD CONSTRAINT CK_C_ETAPA 
CHECK (ETAPA IN (1, 2, 3,4,5))
ENABLE;

 ALTER TABLE A_CIUDADANO
ADD CONSTRAINT CK_C_ESTADO 
CHECK (ESTADO IN ('VACUNADO','NO VACUNADO','NO VACUNABLE'))
ENABLE;

ALTER TABLE A_CIUDADANO
ADD CONSTRAINT fk_c_idusuario
    FOREIGN KEY (IDUSUARIO)
    REFERENCES A_USUARIO(ID)
ENABLE;

--TABLA VACUNACION

CREATE TABLE A_VACUNACION 
   (ID NUMBER, 
	FECHA TIMESTAMP,
    IDPUNTOV NUMBER NULL,
    IDCIUDADANO NUMBER not NULL,
	CONSTRAINT VACUNACION_PK PRIMARY KEY (ID));
    


ALTER TABLE A_VACUNACION
ADD CONSTRAINT fk_v_idpuntov
    FOREIGN KEY (IDPUNTOV)
    REFERENCES A_CIUDADANO(ID)
ENABLE; 
 
 
ALTER TABLE A_VACUNACION
ADD CONSTRAINT fk_v_idciudadano
    FOREIGN KEY (IDCIUDADANO)
    REFERENCES A_CIUDADANO(ID)
ENABLE; 
    
--TABLA PUNTO DE VACUNACION
CREATE TABLE A_PUNTOVACUNACION 
   (ID NUMBER, 
	CAPACIDAD NUMBER NOT NULL,
    LOCALIZACION VARCHAR2(20 BYTE) NOT NULL,
    INFRAESTRUCTURA VARCHAR2(20 BYTE) NOT NULL,
    IDEPS NUMBER NOT NULL,
    IDADMIN NUMBER NOT NULL,
    IDOPERADOR NUMBER NOT NULL,
	CONSTRAINT PUNTO_PK PRIMARY KEY (ID));



ALTER TABLE A_PUNTOVACUNACION
ADD CONSTRAINT fk_p_ideps
    FOREIGN KEY (IDEPS)
    REFERENCES A_EPSREGIONAL(ID)
ENABLE; 

ALTER TABLE A_PUNTOVACUNACION
ADD CONSTRAINT fk_p_idadmin
    FOREIGN KEY (IDADMIN)
    REFERENCES A_USUARIO(ID)
ENABLE; 

ALTER TABLE A_PUNTOVACUNACION
ADD CONSTRAINT fk_p_idoperador
    FOREIGN KEY (IDOPERADOR)
    REFERENCES A_USUARIO(ID)
ENABLE; 


--TABLA EPS REGIONAL
CREATE TABLE A_EPSREGIONAL 
   (ID NUMBER, 
	DOSISTOTALES NUMBER NOT NULL,
    REGION VARCHAR2(20 BYTE) NOT NULL,
    NOMBRE VARCHAR2(20 BYTE) NOT NULL,
    IDADMIN NUMBER NOT NULL,
	CONSTRAINT EPS_PK PRIMARY KEY (ID));
    
ALTER TABLE A_EPSREGIONAL
ADD CONSTRAINT fk_e_idadmin
    FOREIGN KEY (IDADMIN)
    REFERENCES A_USUARIO(ID)
ENABLE; 

